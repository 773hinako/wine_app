# データの安全性について

## データ保存の仕組み

このアプリのデータは**ブラウザ内のIndexedDB**に保存されています。

### アップデート時の影響

✅ **アプリコードをアップデートしてもデータは消えません**

理由：
- アプリのコード（HTML/CSS/JavaScript）とデータ（IndexedDB）は**完全に別**
- Netlifyでアプリを更新しても、ユーザーのブラウザ内のデータには影響なし
- Service Workerがキャッシュを更新しても、IndexedDBは保護される

### データが消える可能性

以下の場合のみデータが消える可能性があります：

1. **ユーザーがブラウザデータを手動削除**
   - 設定 → プライバシー → 「サイトデータ」を削除
   - ⚠️ 通常の「キャッシュクリア」ではIndexedDBは削除されない

2. **ドメインの変更**
   - Netlifyのサイト名を変更すると別ドメイン扱いになる
   - 例: `my-wine-app.netlify.app` → `wine-tasting.netlify.app`

3. **シークレットモード**
   - プライベートブラウジングではウィンドウを閉じると削除

4. **デバイスの容量不足**
   - 極端にストレージが少ない場合（稀）

---

## データ保護対策

### 1. 自動バックアップ機能（実装済み）

- **5分ごと**に自動でLocalStorageにバックアップ
- **最大3世代**のバックアップを保持
- **ページ離脱時**にも自動保存

#### 仕組み
```javascript
// 自動バックアップの動作
- 5分ごとにIndexedDBの全データをLocalStorageに保存
- ブラウザを閉じる前にも保存
- 最新3回分のバックアップを保持
```

#### バックアップの場所
- LocalStorage（ブラウザ内、最大10MB程度）
- キー: `wine-backup`

### 2. 手動エクスポート機能（実装済み）

- アプリ内の **📤 ボタン** でJSONファイルをダウンロード
- いつでも **📥 ボタン** で復元可能

#### 推奨バックアップタイミング
- 重要なワインを追加した後
- 月に1回程度の定期バックアップ
- デバイスやブラウザを変更する前

### 3. Service Workerキャッシュ（実装済み）

- アプリのコード自体をキャッシュ
- オフラインでも動作
- データの保護には直接関係ないが、安定性向上

---

## ユーザーへの推奨事項

### 定期的なバックアップ

**月1回程度の手動エクスポートを推奨：**

1. アプリ内の **📤** ボタンをクリック
2. `wines-backup-YYYYMMDD-HHMMSS.json` ファイルがダウンロード
3. このファイルを安全な場所（クラウドストレージなど）に保存

### 復元方法

1. アプリ内の **📥** ボタンをクリック
2. バックアップファイル（`.json`）を選択
3. データが復元される

---

## 技術的な詳細

### データ保存の階層

```
ブラウザ（ドメインごと）
├── IndexedDB（メインデータ）
│   └── WineDB
│       └── wines（ワインデータ）
│
├── LocalStorage（自動バックアップ）
│   └── wine-backup（最大3世代）
│
└── Cache Storage（Service Worker）
    └── アプリコード（HTML/CSS/JS）
```

### 容量制限

- **IndexedDB**: ブラウザによるが通常50MB〜数GB
- **LocalStorage**: 最大10MB程度
- **写真圧縮**: 自動で最大1200px、品質85%に圧縮

### データの永続性

- **永続化リクエスト**: 将来的に実装可能
  ```javascript
  navigator.storage.persist()
  ```
- **ストレージ使用状況の確認**: 将来的に実装可能
  ```javascript
  navigator.storage.estimate()
  ```

---

## よくある質問

### Q: アプリをアップデートしたらデータは消える？
**A: いいえ、消えません。** コードとデータは別なので安全です。

### Q: ブラウザを変えたらデータは？
**A: 引き継げません。** バックアップファイルをエクスポート→インポートしてください。

### Q: スマホを機種変更したら？
**A: バックアップファイルを新しい端末でインポート**してください。

### Q: 自動バックアップは信頼できる？
**A: 補助的なものです。** 重要なデータは手動エクスポートを推奨します。

### Q: 複数デバイスで同期できる？
**A: 現在は非対応。** 各デバイスで手動エクスポート/インポートが必要です。

---

## 今後の改善案

- [ ] クラウド同期機能（Firebase, Supabaseなど）
- [ ] 定期的な自動エクスポート通知
- [ ] ストレージ使用状況の表示
- [ ] バックアップからの選択的復元
- [ ] 複数デバイス間の同期

---

**結論: Netlifyでアップデートしてもデータは安全です！**
ただし、月1回程度の手動バックアップを推奨します。
