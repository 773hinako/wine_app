# 🧪 写真機能のテストガイド

## テスト実施日: 2025年10月26日

---

## 📋 テスト項目

### 1. Androidでのカメラ起動テスト

**テスト手順**:
1. Android端末でアプリを開く
2. 「+ 新規記録」ボタンをタップ
3. 「📷 写真を撮影/選択」ボタンをタップ
4. 選択肢を確認

**期待される動作**:
- ✅ 「カメラで撮影」が表示される
- ✅ 「ギャラリーから選択」が表示される
- ✅ 「カメラで撮影」を選択すると、カメラアプリが起動する
- ✅ 背面カメラが優先的に使用される

**実装コード**:
```html
<input type="file" id="photo-input" accept="image/*" capture="environment">
```

---

### 2. 端末への写真保存テスト

**テスト手順（モバイル）**:
1. カメラで写真を撮影、またはギャラリーから選択
2. アプリ内でプレビューが表示されることを確認
3. 端末のファイルマネージャーまたは写真アプリを開く
4. 「ダウンロード」フォルダを確認

**期待される動作**:
- ✅ `wine_photo_YYYY-MM-DD-HHMMSS.jpg` という名前で保存される
- ✅ 画像が端末の「ダウンロード」フォルダにある
- ✅ 写真アプリからも参照できる
- ✅ アプリ内（IndexedDB）にも保存される

**テスト手順（デスクトップ）**:
1. ファイル選択で写真を選ぶ
2. プレビューが表示されることを確認
3. ダウンロードフォルダを確認

**期待される動作**:
- ✅ プレビューは表示される
- ⚠️ 自動保存はスキップされる（意図的な仕様）
- ✅ アプリ内（IndexedDB）には保存される

---

### 3. iOSでのカメラ・写真選択テスト

**テスト手順**:
1. iPhone/iPadでアプリを開く（SafariまたはPWA）
2. 「+ 新規記録」ボタンをタップ
3. 「📷 写真を撮影/選択」ボタンをタップ

**期待される動作**:
- ✅ 「写真を撮る」が表示される
- ✅ 「フォトライブラリ」が表示される
- ✅ どちらも正常に動作する
- ✅ 撮影した写真が端末に保存される

---

### 4. 画像圧縮・サムネイル生成テスト

**テスト手順**:
1. 大きいサイズの写真（例: 4000x3000px、5MB）を選択
2. プレビュー表示を確認
3. ワインを保存
4. ワインリストでサムネイル表示を確認
5. 詳細画面で画像表示を確認

**期待される動作**:
- ✅ 圧縮後のサイズ: 詳細表示用 約100-300KB
- ✅ サムネイルサイズ: 約20-50KB
- ✅ 画質が許容範囲内
- ✅ 処理速度が適切

**確認コード**:
```javascript
// app.js内
const compressed = await compressImage(file, 1200, 0.85);  // 詳細表示用
const thumbnail = await compressImage(file, 400, 0.8);     // サムネイル
```

---

### 5. エラーハンドリングテスト

**テスト項目**:

#### 5.1 ファイルサイズ超過
- 10MB以上の画像を選択
- **期待**: 「画像ファイルは10MB以下にしてください」エラー

#### 5.2 画像以外のファイル
- PDFやテキストファイルを選択
- **期待**: 「画像ファイルを選択してください」エラー

#### 5.3 端末保存失敗時
- 端末のストレージが満杯の状態でテスト（可能であれば）
- **期待**: エラーでも処理は継続、アプリ内には保存される

---

### 6. 複数ブラウザ・デバイステスト

| デバイス/ブラウザ | カメラ起動 | 写真選択 | 端末保存 | 結果 |
|------------------|-----------|---------|---------|-----|
| Android + Chrome | ✅ 期待   | ✅ 期待 | ✅ 期待 | [ ] |
| Android + Edge   | ✅ 期待   | ✅ 期待 | ✅ 期待 | [ ] |
| iPhone + Safari  | ✅ 期待   | ✅ 期待 | ✅ 期待 | [ ] |
| iPhone + Chrome  | ✅ 期待   | ✅ 期待 | ✅ 期待 | [ ] |
| Windows + Chrome | ❌ N/A    | ✅ 期待 | ❌ スキップ | [ ] |
| macOS + Safari   | ❌ N/A    | ✅ 期待 | ❌ スキップ | [ ] |

---

## 🔧 デバッグ方法

### Chromeデベロッパーツール（モバイル）

**Android Chrome**:
1. PCとAndroid端末をUSB接続
2. Chrome DevToolsで `chrome://inspect` を開く
3. 端末のアプリを選択
4. Consoleタブでエラーを確認

**確認項目**:
```javascript
// コンソールに表示されるログ
console.log('Service Worker registered');
console.log('Desktop browser detected - skipping auto-save');
console.warn('写真の端末保存に失敗しましたが...');
```

### Safari Web Inspector（iOS）

**iPhone Safari**:
1. iPhoneで「設定」→「Safari」→「詳細」→「Webインスペクタ」をON
2. Macで Safari → 「開発」メニュー → iPhone選択
3. コンソールでエラーを確認

---

## 📊 テスト結果記録

### テスト実施者: _________________
### 実施日時: _________________

#### Android実機テスト
- [ ] カメラ起動: OK / NG
- [ ] 写真選択: OK / NG
- [ ] 端末保存: OK / NG
- [ ] 画像圧縮: OK / NG

#### iOS実機テスト
- [ ] カメラ起動: OK / NG
- [ ] 写真選択: OK / NG
- [ ] 端末保存: OK / NG
- [ ] 画像圧縮: OK / NG

#### デスクトップテスト
- [ ] 写真選択: OK / NG
- [ ] プレビュー表示: OK / NG
- [ ] アプリ内保存: OK / NG

### 発見された問題
```
問題1:
症状:
再現手順:
対処:

問題2:
症状:
再現手順:
対処:
```

---

## 🚀 ローカルサーバー起動方法

### PowerShell（Windows）
```powershell
# プロジェクトルートに移動
cd e:\wine

# Pythonサーバー起動
python -m http.server 8000

# または、Node.jsのhttp-server
npx http-server -p 8000
```

### アクセスURL
- ローカル: http://localhost:8000/public/
- スマホから: http://[PCのIPアドレス]:8000/public/

### IPアドレス確認（Windows）
```powershell
ipconfig
# 「IPv4 アドレス」の値を使用（例: 192.168.1.100）
```

---

## ✅ チェックリスト

### 実装完了項目
- [x] `capture="environment"` 属性を追加
- [x] `savePhotoToDevice()` 関数を実装
- [x] `downloadImageToDevice()` 関数を実装
- [x] デスクトップでの自動保存スキップ処理
- [x] エラーハンドリング（写真保存失敗時の続行）
- [x] ドキュメント作成（PHOTO-FEATURES.md）
- [x] README.md更新
- [x] DEVELOPMENT-STATUS.md更新

### テスト待ち項目
- [ ] Android実機での動作確認
- [ ] iOS実機での動作確認
- [ ] 写真の端末保存確認
- [ ] 画像圧縮の品質確認
- [ ] パフォーマンス測定

---

最終更新: 2025年10月26日
