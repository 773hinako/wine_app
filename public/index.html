<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#FFB6D9">
    <meta name="description" content="ワインの記録を管理するPWAアプリ">

    <!-- iOS用メタタグ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ワイン記録">

    <title>ワイン記録</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="../src/css/styles.css">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png">
</head>
<body>
    <!-- ホーム画面 -->
    <div id="home-screen" class="screen active">
        <header>
            <h1>🍷 ワイン記録</h1>
            <div class="header-actions">
                <button id="stats-btn" class="icon-btn" title="統計">📊</button>
                <button id="dark-mode-btn" class="icon-btn" title="ダークモード">🌙</button>
                <button id="export-btn" class="icon-btn" title="エクスポート">📤</button>
                <button id="import-btn" class="icon-btn" title="インポート">📥</button>
            </div>
        </header>

        <div class="search-container">
            <input type="text" id="search-input" placeholder="🔍 ワイン名、産地、品種、メモで検索...">
        </div>

        <div class="filter-sort-container">
            <select id="filter-select" class="filter-select">
                <option value="all">すべて</option>
                <option value="favorite">⭐ お気に入り</option>
                <option value="red">🍷 赤ワイン</option>
                <option value="white">🥂 白ワイン</option>
                <option value="rose">🌸 ロゼ</option>
                <option value="sparkling">🍾 スパークリング</option>
            </select>

            <select id="sort-select" class="sort-select">
                <option value="date-desc">📅 新しい順</option>
                <option value="date-asc">📅 古い順</option>
                <option value="rating-desc">⭐ 評価高い順</option>
                <option value="rating-asc">⭐ 評価低い順</option>
                <option value="name-asc">🔤 名前順（あ→ん）</option>
                <option value="name-desc">🔤 名前順（ん→あ）</option>
            </select>
        </div>

        <div id="wine-list" class="wine-list"></div>

        <button id="add-wine-btn" class="fab">+</button>
    </div>

    <!-- 統計画面 -->
    <div id="stats-screen" class="screen">
        <header>
            <button id="stats-back-btn" class="icon-btn">← 戻る</button>
            <h1>📊 統計</h1>
        </header>
        <div id="stats-content" class="stats-content"></div>
    </div>

    <!-- 新規記録/編集画面 -->
    <div id="edit-screen" class="screen">
        <header>
            <button id="back-btn" class="icon-btn">← 戻る</button>
            <h1 id="edit-title">新規記録</h1>
        </header>

        <form id="wine-form" class="wine-form">
            <div class="photo-section">
                <div id="photo-preview" class="photo-preview">
                    <span class="photo-placeholder">📷 写真を追加</span>
                </div>
                <input type="file" id="photo-input" accept="image/*" capture="environment" style="display: none;">
                <!-- ギャラリーから選ぶ用（カメラ強制しない） -->
                <input type="file" id="gallery-input" accept="image/*" style="display: none;">
                <div class="photo-buttons">
                    <button type="button" id="photo-btn" class="btn-secondary">📷 写真を撮影/選択</button>
                    <button type="button" id="ocr-btn" class="btn-ocr" style="display: none;">🔍 ラベルを読み取る</button>
                </div>
                <p style="font-size: 0.875rem; color: #666; margin-top: 0.5rem;">カメラで撮影、またはギャラリーから既存の写真を選択できます</p>
                <!-- 端末の写真アプリへ保存（共有） -->
                <button type="button" id="save-photo-btn" class="btn-tertiary" style="display:none; margin-top: 0.5rem;">💾 端末に保存</button>
                <div id="ocr-result" class="ocr-result" style="display: none;"></div>
            </div>

            <div class="form-group">
                <label for="wine-name">ワイン名 *</label>
                <input type="text" id="wine-name" required>
            </div>

            <div class="form-group">
                <label for="producer">生産者/ワイナリー</label>
                <input type="text" id="producer">
            </div>

            <div class="form-group">
                <label for="region">産地</label>
                <input type="text" id="region">
            </div>

            <div class="form-group">
                <label for="variety">品種</label>
                <input type="text" id="variety">
            </div>

            <div class="form-group">
                <label for="vintage">ヴィンテージ（年）</label>
                <input type="number" id="vintage" min="1900" max="2100">
            </div>

            <div class="form-group">
                <label for="date">購入日/飲んだ日</label>
                <input type="date" id="date">
            </div>

            <div class="form-group">
                <label for="rating">評価</label>
                <div class="rating-input">
                    <span class="star" data-value="1">☆</span>
                    <span class="star" data-value="2">☆</span>
                    <span class="star" data-value="3">☆</span>
                    <span class="star" data-value="4">☆</span>
                    <span class="star" data-value="5">☆</span>
                </div>
                <input type="hidden" id="rating" value="0">
            </div>

            <!-- テイスティングメモ -->
            <div class="tasting-section">
                <h3 class="section-title">🍷 テイスティングメモ</h3>

                <!-- ワインタイプ -->
                <div class="form-group">
                    <label>ワインタイプ</label>
                    <div class="radio-group">
                        <label class="radio-label"><input type="radio" name="wine-type" value="red" checked> 赤</label>
                        <label class="radio-label"><input type="radio" name="wine-type" value="white"> 白</label>
                        <label class="radio-label"><input type="radio" name="wine-type" value="rose"> ロゼ</label>
                        <label class="radio-label"><input type="radio" name="wine-type" value="sparkling"> スパークリング</label>
                    </div>
                </div>

                <!-- 外観 -->
                <div class="form-group">
                    <label for="appearance-color">外観（色）</label>
                    <select id="appearance-color" class="select-input">
                        <option value="">選択してください</option>
                        <optgroup label="赤ワイン">
                            <option value="パープル">パープル（若い）</option>
                            <option value="ルビー">ルビー</option>
                            <option value="ガーネット">ガーネット</option>
                            <option value="レンガ色">レンガ色（熟成）</option>
                        </optgroup>
                        <optgroup label="白ワイン">
                            <option value="レモンイエロー">レモンイエロー（若い）</option>
                            <option value="イエロー">イエロー</option>
                            <option value="ゴールド">ゴールド</option>
                            <option value="琥珀色">琥珀色（熟成）</option>
                        </optgroup>
                        <optgroup label="ロゼ">
                            <option value="ピンク">ピンク</option>
                            <option value="サーモンピンク">サーモンピンク</option>
                            <option value="オレンジ">オレンジ</option>
                        </optgroup>
                    </select>
                </div>

                <!-- 香り -->
                <div class="form-group">
                    <label>香り（複数選択可）</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="ベリー系"> 🍓 ベリー系</label>
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="シトラス"> 🍋 シトラス</label>
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="トロピカル"> 🥭 トロピカル</label>
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="リンゴ・洋梨"> 🍎 リンゴ・洋梨</label>
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="花"> 🌸 花</label>
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="ハーブ"> 🌿 ハーブ</label>
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="スパイス"> ⭐ スパイス</label>
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="オーク・バニラ"> 🪵 オーク・バニラ</label>
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="土・きのこ"> 🍄 土・きのこ</label>
                        <label class="checkbox-label"><input type="checkbox" name="aroma" value="ミネラル"> 💎 ミネラル</label>
                    </div>
                </div>

                <!-- アロマの段階（ソムリエ向け） -->
                <div class="form-group">
                    <label>🎓 アロマの段階（ソムリエ分類）</label>
                    <div style="background: #f5f5f5; padding: 0.75rem; border-radius: 8px; margin-bottom: 0.75rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <strong>第一アロマ（一次香）</strong>
                            <small style="display: block; color: #666;">ブドウ品種由来の香り</small>
                            <input type="text" id="first-aroma" class="select-input" placeholder="例: カシス、青ピーマン、ライチ" style="margin-top: 0.25rem;">
                        </div>
                        <div style="margin-bottom: 0.5rem;">
                            <strong>第二アロマ（二次香）</strong>
                            <small style="display: block; color: #666;">発酵・醸造由来の香り</small>
                            <input type="text" id="second-aroma" class="select-input" placeholder="例: バター、ヨーグルト、ナッツ" style="margin-top: 0.25rem;">
                        </div>
                        <div>
                            <strong>第三アロマ（三次香・ブーケ）</strong>
                            <small style="display: block; color: #666;">熟成由来の香り</small>
                            <input type="text" id="third-aroma" class="select-input" placeholder="例: トリュフ、枯葉、革、タバコ" style="margin-top: 0.25rem;">
                        </div>
                    </div>
                </div>

                <!-- 樽感の強さ -->
                <div class="form-group">
                    <label for="oak-intensity">🪵 樽感（オーク感）の強さ</label>
                    <select id="oak-intensity" class="select-input">
                        <option value="">選択してください</option>
                        <option value="樽感なし">樽感なし（ステンレスタンク熟成）</option>
                        <option value="弱い">弱い（新樽比率低・短期熟成）</option>
                        <option value="中程度">中程度（バランス型）</option>
                        <option value="強い">強い（新樽比率高・長期熟成）</option>
                        <option value="非常に強い">非常に強い（100%新樽など）</option>
                    </select>
                </div>

                <!-- 味わい -->
                <div class="form-group">
                    <label for="taste-sweetness">甘さ</label>
                    <select id="taste-sweetness" class="select-input">
                        <option value="">選択してください</option>
                        <option value="辛口">辛口</option>
                        <option value="やや辛口">やや辛口</option>
                        <option value="やや甘口">やや甘口</option>
                        <option value="甘口">甘口</option>
                        <option value="極甘口">極甘口</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="taste-acidity">酸味</label>
                    <select id="taste-acidity" class="select-input">
                        <option value="">選択してください</option>
                        <option value="低い">低い</option>
                        <option value="中程度">中程度</option>
                        <option value="高い">高い</option>
                    </select>
                </div>

                <div class="form-group" id="tannin-group">
                    <label for="taste-tannin">タンニン（赤ワインのみ）</label>
                    <select id="taste-tannin" class="select-input">
                        <option value="">選択してください</option>
                        <option value="軽い">軽い</option>
                        <option value="中程度">中程度</option>
                        <option value="強い">強い</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="taste-body">ボディ</label>
                    <select id="taste-body" class="select-input">
                        <option value="">選択してください</option>
                        <option value="ライト">ライト</option>
                        <option value="ミディアム">ミディアム</option>
                        <option value="フル">フル</option>
                    </select>
                </div>

                <!-- 余韻 -->
                <div class="form-group">
                    <label for="finish">余韻</label>
                    <select id="finish" class="select-input">
                        <option value="">選択してください</option>
                        <option value="短い">短い</option>
                        <option value="中程度">中程度</option>
                        <option value="長い">長い</option>
                    </select>
                </div>

                <!-- 追加メモ -->
                <div class="form-group">
                    <label for="additional-notes">追加メモ（自由記述）</label>
                    <textarea id="additional-notes" rows="3" placeholder="その他、気づいたことや印象を自由に書いてください"></textarea>
                </div>
            </div>

            <button type="submit" class="btn-primary">保存</button>
        </form>
    </div>

    <!-- 詳細表示画面 -->
    <div id="detail-screen" class="screen">
        <header>
            <button id="detail-back-btn" class="icon-btn">← 戻る</button>
            <h1>詳細</h1>
            <div class="header-actions">
                <button id="edit-detail-btn" class="icon-btn">✏️</button>
                <button id="delete-btn" class="icon-btn">🗑️</button>
            </div>
        </header>

        <div id="wine-detail" class="wine-detail"></div>
    </div>

    <!-- インポート用の隠しファイル入力 -->
    <input type="file" id="import-file-input" accept=".json" style="display: none;">

    <!-- 写真ソース選択のアクションシート -->
    <div id="photo-source-sheet" class="action-sheet" style="display:none;">
        <div class="action-sheet-backdrop" id="photo-source-backdrop"></div>
        <div class="action-sheet-panel">
            <h3 class="action-sheet-title">写真の取得方法</h3>
            <button class="sheet-btn" id="choose-camera">📷 カメラで撮影</button>
            <button class="sheet-btn" id="choose-gallery">🖼️ ギャラリーから選択</button>
            <button class="sheet-cancel" id="choose-cancel">キャンセル</button>
        </div>
    </div>

    <!-- Tesseract.js for OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    
    <script src="../src/js/db.js"></script>
    <script src="../src/js/features.js"></script>
    <script src="../src/js/auto-backup.js"></script>
    <script src="../src/js/ocr.js"></script>
    <script src="../src/js/app.js"></script>
</body>
</html>
